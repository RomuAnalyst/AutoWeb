---
title: "Analyse des Boîtes de Match de Basketball"
author: "Romuanalyst"
date: "`r format(Sys.time(), '%d/%m/%Y %H:%M:%S')`"
format: html
---

## Introduction

Ce document présente une analyse des boîtes de match de basketball en utilisant le package `rvest` pour le scraping de données.

```{r message = F}
# Installer les packages nécessaires si absent

to_install <- c("ggplot2", "dplyr", "readr", "rvest", "tidyverse", "gridExtra", "grid")

new_packages <- to_install[!(to_install %in% installed.packages()[,"Package"])]

if(length(new_packages)) install.packages(new_packages)


library(rvest)
library(tidyverse)
library(gridExtra) # Load gridExtra
library(grid) # Load grid for textGrob

url <- "https://www.basketball-reference.com/boxscores/"

# Scrape all tables from the webpage
tables <- url %>%
  read_html() %>%
  html_table(fill = TRUE)

# Create data frames dynamically
list2env(
  setNames(tables, paste0("df", seq_along(tables))),
  envir = .GlobalEnv
)

# Function to process each group of 3 tables
process_tables <- function(df1, df2, df3) {
  # Remove the 3rd column from df1 (if it exists)
  if (ncol(df1) >= 3) {
    df1 <- df1[, -3]
  }
  
  # Remove the 1st column from df2 (if it exists)
  if (ncol(df2) >= 1) {
    df2 <- df2[, -1]
  }
  
  # Combine df1 and df2 side by side
  df_combined <- cbind(df1, df2)
  
  # Return a list containing the main table and the side table
  return(list(main_table = df_combined, side_table = df3))
}

# Initialize a list to store the results
results <- list()

# Process the tables in groups of 3
for (i in seq(1, length(tables), by = 3)) {
  if (i + 2 <= length(tables)) { # Verify that there is a complete group of 3 tables
    group_result <- process_tables(get(paste0("df", i)), 
                                   get(paste0("df", i + 1)), 
                                   get(paste0("df", i + 2)))
    results[[paste0("équipe_", i %/% 3 + 1)]] <- group_result
  }
}

# Function to display tables in boxes
display_tables <- function(main_table, side_table, group_name) {
  # Convert tables to grob objects
  main_grob <- tableGrob(main_table, rows = NULL)
  side_grob <- tableGrob(side_table, rows = NULL)
  
  # Add a title to the arrangement
  title <- textGrob(paste("Match", group_name), 
                    gp = gpar(fontsize = 16, fontface = "bold"))
  
  # Arrange the tables side by side with a title
  grid.arrange(title, main_grob, side_grob, 
               ncol = 2, 
               layout_matrix = rbind(c(1, 1), c(2, 3)),
               heights = c(0.1, 1)) # Adjust heights for title and tables
}

# Display the results for each group in boxes
for (group_name in names(results)) {
  display_tables(results[[group_name]]$main_table, 
                 results[[group_name]]$side_table, 
                 group_name)
}
```
